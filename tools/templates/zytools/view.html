{% extends "layouts/base.html" %}
{% block content %}
<div style='margin:1%;'>
    <h1 style="color: #003DA5;">Programming Behaviour Analysis</h1>
    <h3 style="color: #003DA5;">Student details</h3>
    <div class="card">
        <div class="card-body">
            <p><strong>First Name :</strong> {{result.First_Name}}</p>
            <p><strong>Last Name :</strong> {{result.Last_Name}}</p>
            <p><strong>Email :</strong> {{result.Email}}</p>
            <p><strong>User ID:</strong> {{result.User_ID}}</p>
            <p><strong>Role :</strong> {{result.Role}}</p>
            <p><strong>Totals across all labs:</strong></p>
            <p><strong>Total Score :</strong> {{result.Total_Score}}</p>
            <p><strong>Total Runs :</strong> {{result.Total_Runs}}</p>
            <p><strong>Total Develops :</strong> {{result.Total_Develops}}</p>
            <p><strong>Total Submits:</strong> {{result.Total_Submits}}</p>
        </div>
    </div>
</div>

<br />
<div style='margin:1%;'>
    {% for lab, arr in result.Labs.items %}
    <div class="card">
        <div class="card-body">
            <h3 style="color: #003DA5;">{{lab}} {{arr.submissions.0.caption.0}}</h3>

            <h6>Lines Graph:</h6>
            <div style="width:500px; margin: 1%;">
                <canvas id="Lines_Trail_Chart_{{lab}}"></canvas>
            </div>
            <script>
                var myChart = new Chart(
                    document.getElementById('Lines_Trail_Chart_{{lab}}'), {
                        type: 'line',
                        data: {
                            labels: {{ arr.score_trail_label }},
                            datasets: [{
                                label: 'Lines Trail',
                                data: {{ arr.score_trail_data }},
                                fill: false,
                                borderColor: 'rgb(75, 192, 192)',
                                tension: 0.1
                            }]
                        },
                        options: {
                            scales: {
                                x: {
                                    title: {
                                        display: "true",
                                        text: "Code run"
                                    }
                                },
                                y: {
                                    beginAtZero: true,
                                    title: {
                                        display: true,
                                        text: 'number of lines'
                                    }
                                }
                            }
                        }
                    });
            </script>
            <br/>
            <p><strong>Incremental Development Score Trail:</strong> {{arr.incdev_score_trail}}</p>
            <p><strong>Lines of Code Trail :</strong> {{arr.loc_trail}}</p>
            <p><strong>Time Trail:</strong> {{arr.time_trail}}</p>
            <h6><strong>Code Runs:</strong></h6>
            <div class="accordion" style='width:70%;margin-left: 1%;' id="accordionExample">
                <form action="" method='POST' enctype='multipart/form-data'>
                    {% csrf_token %}
                    <p>Please select two code files from below checkboxes and hit get differences</p><input class="custom_button" type='submit'
                        value='Get differences' name='Get differences' onclick="show_difference_block()">
                    <br /><br />

                    <div id="difference_block" style="width: 98%; height: 100%; padding-bottom: 10px; margin-left: 2%;">
                        <pre class="line-numbers"><code class="language-diff-cpp diff-highlight">{{ arr.code_diff }}</code></pre>
                    </div>

                    {% for submission in arr.submissions %}
                    <div style="display: flex;flex-direction: row">
                        <div style="width: 2%; display: flex; align-items: center;">
                            <input class="form-check-input" type="checkbox" name="checkbox_labs" id="inlineRadio1"
                                value="{{lab}}_{{submission.submission_id}}" style="margin-right: 1%;">
                        </div>
                        <div class="accordion-item" style="width: 98%; align-items: center;">
                            <h2 class="accordion-header" id="heading_{{submission.submission_id}}">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#acc_{{submission.submission_id}}" aria-expanded="false"
                                    aria-controls="acc_{{submission.submission_id}}">
                                    {{ forloop.counter }} . 
                                    Submission time: {{ submission.sub_time }} Score = {{ submission.max_score }}
                                    {% if submission.suspicious == 'yes' %} 
                                    <span class="badge rounded-pill text-outline" style="background-color: red; margin-left: 1%;">Suspicious</span>
                                    {% endif %}
                                    {% if submission.submission.0 == 1.0 %}
                                    <span class="badge rounded-pill text-outline" style="background-color: rgb(0, 68, 255); margin-left: 1%;">Submit Run</span>
                                    {% else %}
                                    <span class="badge rounded-pill text-outline" style="background-color: green; margin-left: 1%;">Develop Run</span>
                                    {% endif %}
                                </button>
                            </h2>
                            <div id="acc_{{submission.submission_id}}" class="accordion-collapse collapse"
                                aria-labelledby="heading_{{submission.submission_id}}">
                                <div class="accordion-body">

                                    <nav>
                                        <div class="nav nav-tabs mb-3" id="nav-tab" role="tablist">
                                            <button class="nav-link active" id="nav-home-tab" data-bs-toggle="tab" data-bs-target="#actual_{{submission.submission_id}}" type="button" role="tab" aria-controls="nav-home" aria-selected="true">Code</button>
                                            <button class="nav-link" id="nav-profile-tab" data-bs-toggle="tab" data-bs-target="#diff_{{submission.submission_id}}" type="button" role="tab" aria-controls="nav-profile" aria-selected="false">Changes</button>
                                            <button class="nav-link" id="nav-profile-tab" data-bs-toggle="tab" data-bs-target="#mod_{{submission.submission_id}}" type="button" role="tab" aria-controls="nav-profile" aria-selected="false">Modifications</button>
                                        </div>
                                    </nav>
                                
                                    <div class="tab-content p-3 border bg-light" id="nav-tabContent">
                                        <div class="tab-pane fade active show" id="actual_{{submission.submission_id}}" role="tabpanel" aria-labelledby="nav-home-tab">
                                            <pre class="language-cpp line-numbers" data-line="1-2,4"><code>{{ submission.code }}</code></pre>
                                        </div>
                                        <div class="tab-pane fade" id="diff_{{submission.submission_id}}" role="tabpanel" aria-labelledby="nav-profile-tab">
                                            <pre class="line-numbers"><code class="language-diff-cpp diff-highlight">{{ submission.code_diff }}</code></pre>
                                        </div>
                                        <div class="tab-pane fade" id="mod_{{submission.submission_id}}" role="tabpanel" aria-labelledby="nav-profile-tab">
                                            <pre class="line-numbers"><code class="language-diff-cpp diff-highlight">{{ submission.code.mod }}</code></pre>
                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </form>
            </div>
    </div>
    <br/>
</div>
{% endfor %}
{% endblock %}